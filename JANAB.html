<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Teacher Portal — Tanbeeh & Tashjeeh</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #1f8feb;
    --primary-dark: #0f63a8;
    --success: #2e7d32;
    --warning: #e04b4b;
    --light: #f8fbff;
    --gray: #64748b;
    --shadow: 0 20px 50px rgba(0,0,0,0.15);
    --card-shadow: 0 10px 30px rgba(31,143,235,0.15);
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0f63a8 0%, #1e3c72 50%, #2a5298 100%);
    min-height: 100vh;
    padding: 15px 10px;
    color: #333;
    background-attachment: fixed;
  }

  .container { max-width: 1100px; margin: 0 auto; }

  .header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 18px;
    margin-bottom: 25px;
    flex-wrap: wrap;
    animation: fadeInDown 0.9s ease;
  }

  .logo img {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    border: 5px solid rgba(255,255,255,0.4);
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    object-fit: contain;
    background: white;
    padding: 5px;
  }

  .title-group { text-align: center; }
  h1 {
    font-size: 30px;
    background: linear-gradient(90deg, #4facfe, #00f2fe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 700;
    margin: 0;
    line-height: 1.2;
  }
  .subtitle { color: rgba(255,255,255,0.95); font-size: 15px; font-weight: 500; margin-top: 4px; }

  .card {
    background: rgba(255,255,255,0.98);
    border-radius: 24px;
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.3);
    animation: fadeInUp 0.8s ease;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 18px;
    margin-bottom: 20px;
  }

  label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--primary); font-size: 15px; }
  select, input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #e0e8ff;
    border-radius: 16px;
    font-size: 15px;
    background: white;
    transition: all 0.3s ease;
  }
  select:focus, input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(31,143,235,0.15);
    transform: translateY(-2px);
  }

  .btn-group { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 10px; }
  button {
    padding: 14px 20px;
    border: none;
    border-radius: 16px;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    min-width: 140px;
  }
  .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
  .btn-danger { background: linear-gradient(135deg, #e04b4b, #c82333); color: white; }
  .btn-secondary { background: #64748b; color: white; padding: 12px 18px; font-size: 14px; }
  button:hover { transform: translateY(-4px); box-shadow: 0 12px 25px rgba(0,0,0,0.2); }

  .message { padding: 16px 20px; border-radius: 16px; margin: 15px 0; font-weight: 600; font-size: 15px; animation: slideIn 0.5s ease; }
  .success { background: #e6ffed; border: 2px solid #b6f0c8; color: var(--success); }
  .warn { background: #fff3e6; border: 2px solid #ffd0a8; color: #e65100; }

  .table-container { overflow-x: auto; border-radius: 20px; box-shadow: var(--card-shadow); margin-top: 10px; background: white; }
  table { width: 100%; border-collapse: collapse; font-size: 14.5px; }
  th {
    background: linear-gradient(90deg, var(--primary-dark), var(--primary));
    color: white;
    padding: 16px 12px;
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 0.5px;
  }
  td { padding: 14px 10px; text-align: center; border-bottom: 1px solid #f0f4ff; }
  tr:hover td { background: #f5f9ff; }
  .tan { background: #ffebee !important; color: #c62828; font-weight: 700; }
  .tash { background: #e8f5e9 !important; color: #2e7d32; font-weight: 700; }
  .total-positive { color: #2e7d32; font-weight: 700; }
  .total-negative { color: #c62828; font-weight: 700; }

  .history-card h2 {
    font-size: 22px;
    background: linear-gradient(90deg, #00f2fe, #4facfe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 15px;
  }
  .history-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; margin-bottom: 15px; }
  .log-tanbeeh { background: #ffebee; }
  .log-tashjeeh { background: #e8f5e9; }
  .teacher-name { color: var(--primary); font-weight: 600; }
  .timestamp { color: #777; font-size: 12.5px; }

  @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

  @media (max-width: 600px) {
    .header { gap: 14px; }
    .logo img { width: 70px; height: 70px; }
    h1 { font-size: 26px; }
    .card { padding: 20px; }
    .form-grid { grid-template-columns: 1fr; }
    button { width: 100%; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="logo">
      <img src="https://i.ibb.co/Ndqj258K/panchgani-removebg-preview.png" alt="Logo">
    </div>
    <div class="title-group">
      <h1>Teacher Portal</h1>
      <p class="subtitle">Tanbeeh & Tashjeeh Management System</p>
    </div>
  </div>

  <div class="card">
    <div class="form-grid">
      <div class="form-group">
        <label>Student</label>
        <select id="studentNo"></select>
      </div>
      <div class="form-group">
        <label>Type</label>
        <select id="type">
          <option value="Tanbeeh">Tanbeeh (Warning)</option>
          <option value="Tashjeeh">Tashjeeh (Appreciation)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Reason</label>
        <select id="item"></select>
      </div>
      <div class="form-group">
        <label>Teacher Name</label>
        <input type="text" id="teacherName" placeholder="Enter your name" required />
      </div>
    </div>

    <div class="btn-group">
      <button id="addPts" class="btn-primary">Add Points</button>
      <button id="resetStudent" class="btn-danger">Reset Student</button>
      <button id="showParentBtn" class="btn-secondary">Live Parent Portal (Points)</button>
      <button id="showLogBtn" class="btn-secondary">Live Activity Log</button>
    </div>
  </div>

  <div id="message"></div>

  <div class="card">
    <div class="table-container">
      <table id="pointsTable">
        <thead>
          <tr><th>No.</th><th>Name</th><th class="tan">Tanbeeh</th><th class="tash">Tashjeeh</th><th>Total</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card history-card">
    <div class="history-header">
      <h2>Activity Log</h2>
      <button id="clearHistoryBtn" class="btn-danger">Clear All Log</button>
    </div>
    <div class="table-container">
      <table class="history-table" id="historyTable">
        <thead>
          <tr><th>Date & Time</th><th>Student</th><th>Type</th><th>Reason</th><th>Points</th><th>Added By</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
// ─────────────────────── URLs & Data ───────────────────────
const POINTS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxNQGEGdAhJQT0satxJZA16EaRAtc344Jjz--fJFZoNITdc_f2sc8hO3B-rtobRs25OPQ/exec";
const LOG_WEB_APP_URL    = "https://script.google.com/macros/s/AKfycbxNQGEGdAhJQT0satxJZA16EaRAtc344Jjz--fJFZoNITdc_f2sc8hO3B-rtobRs25OPQ/exec";

const STORAGE_KEY = 'tanbeehTashjeehPoints_v2';
const HISTORY_KEY = 'tanbeehTashjeehHistory_v2';

const studentNames = ["Burhanuddin ali mohammad bhai Bazar","Abdulkadir M. Mustafa Bhai Hamid","Taher Aliasger Bhai Musaji","Mustafa Yusuf Bhai Dawoodi","Mufaddal mustansir bhai rangwala","Husain Murtaza bhai Ahemadabad","Shabbir Habib Bhai Jalali","Taher Dawood Bhai Suksar","Mohammed Shk Huzaifa Shakir","Burhanuddin Shabbir Bhai Sabunwala","Adnan Juzer Bhai Banswadi","Aziz Husain Saeed Abbas Bhai Saghar","Burahanuddin hussain bhai chittalwala","Husain mohammad bhai bootwala","Mohammed Burhanuddin Bhai Gharyali","Husain murtaza Fatehnagar","Taha Firoz Bhai Petlawad","Burhanuddin Juzer Bhai Saifee","Ibrahim Aliasger Bhai Marhaba","Qusai Mandasaur","Taha Fakhruddin Bhagat","Mohammed Mustafa bhai Dewaswala","Burhanuddin Saleh Bhai Lakda","Abdulqadir Haider Disa","Mohammed Primas","Mohammed Mustafa Bhai Qudrati","Hussain Yusuf bhai kanore wala","Ibrahim Hatim Bhai Pathari","Murtaza Raj","Mufaddal Yusuf Bhai Motor","Hatim Abbas Bhai Kathana","Behlul Khuzaima Saifee","Mohammed Mustafa Bhai Paghri","Hussain Sadri","Fakhruddin murtaza bhai ezzy","Taha Abbas Bhai Mhow"];

const tanbeehData = [{text:"Khidmat Guzaro ni taazem ma farq paru che",pts:10},{text:"Bad kalam che, Gaali bolva ni adat che",pts:5},{text:"taheez ma pota na quran nai lauta",pts:2},{text:"Khidmatguzaar, staff, farzando sathe sulook barabar nathi",pts:2},{text:"Sareqat kidi che",pts:10},{text:"jhoot bole che",pts:2},{text:"Building ma farzando sathe jhagro kare che",pts:3},{text:"Nizaam mutabiq amal karva ma be farag nazar ave che (Taujih karva baad)",pts:1},{text:"Tilawat Al-Dua ma potani Qiraat/Dua ni tilawat na kidi",pts:3},{text:"ghair mumasib shakelt si kapda pehne che (Taujih karva baad)",pts:2},{text:"Baghair raza jagah par electronic gadgets rakhe che",pts:3},{text:"Launday ma kapda nathi apta",pts:5},{text:"Tahfeez ma takheer si hazir thaye che (Taujih karva baad)",pts:4},{text:"Tilawat Al-Dua ma Dua ni Tilawat ma ghair hazir hata",pts:2},{text:"Namaz ma masallo lai ne nathi aya (per namaz)",pts:1},{text:"Namaz ma ghair hazir rahe che (per day)",pts:5},{text:"azan aapwa waste gair hazir hata",pts:5},{text:"MHD equipments nesambhalwa ma faraq kido che",pts:1},{text:"Room ma cricket ya e misal ni games rame che",pts:3},{text:"Room ni lights, fan band nathi kidi",pts:2},{text:"Libaas ni nazafat nathi rakhata (Taujih karva bad)",pts:2},{text:"Mohta baal rakhe che (Taujih karva bad)",pts:3},{text:"Raate tilawat Al-Qasaid ma ghair hazir rahe che (Weekly)",pts:3},{text:"Tilawat al-Qasaid ma takheer si ave che",pts:1},{text:"Bed par chadar nathi",pts:2},{text:"Bed par kapda kitabo ya bags muke che",pts:2}];

const tashjeehData = [{text:"Active participation in sports event (Weekly)",pts:2},{text:"Active participation in vocal practice (Weekly)",pts:2},{text:"Active performance in Events; Participation in Internal Events",pts:1},{text:"Actively assists in winding up and maintaining cleanliness",pts:2},{text:"Balancing Academics and Sports",pts:2},{text:"Bimar farzand ne pareegva gaya",pts:2},{text:"Class test ma performance achu che",pts:3},{text:"Teamwork in academic projects",pts:5},{text:"Consistently follows instructions with care and accuracy",pts:7},{text:"Duo ni tilawat kare che (Weekly)",pts:3},{text:"Ek mahina ma 10 si 14 Safahat na darmiyaan jaeed hifz",pts:5},{text:"Ek mahina ma 15 si 20 Safahat na darmiyaan jaeed hifz",pts:10},{text:"Fajar ni namaz baad tul u shams lag masail par bethi ne duo parhwani aadat",pts:3},{text:"Fajr ni Namaz ma 100% Hazri che (Weekly)",pts:5},{text:"Ghana behtar andaz ma takbeera dida che",pts:3},{text:"Ghani behtar andaz ma azan didi che",pts:2},{text:"Habitually reads periodicals and stays aware",pts:5},{text:"Hafiz che ane hifz mazboot rakhe (Weekly)",pts:7},{text:"Has achieved success in external exams",pts:3},{text:"Performed well in skits/quiz/stage program",pts:3},{text:"library ma si kitabo lai ne parhwa ni adat (daily)",pts:3},{text:"Majlis ma behtar shakelet si tilawat kidi che",pts:1},{text:"Maktabat na kitabao ma si daily reading",pts:5},{text:"Marhala na ikhtebaar ma kamyab thaya che",pts:20},{text:"muhafiz je tasks aape che ehne behtar shakelet si kare che (Weekly)",pts:3},{text:"Nahna darajah na farzand ne 'bhai' kahi ne bulave che",pts:2}];

let points = JSON.parse(localStorage.getItem(STORAGE_KEY)) || Array(studentNames.length).fill().map(()=>({tanbeeh:0,tashjeeh:0}));
let history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];

// Elements
const studentSelect = document.getElementById('studentNo');
const typeSelect = document.getElementById('type');
const itemSelect = document.getElementById('item');
const teacherNameInput = document.getElementById('teacherName');
const addBtn = document.getElementById('addPts');
const resetStudentBtn = document.getElementById('resetStudent');
const clearHistoryBtn = document.getElementById('clearHistoryBtn');
const showParentBtn = document.getElementById('showParentBtn');
const showLogBtn = document.getElementById('showLogBtn');
const messageDiv = document.getElementById('message');
const tableBody = document.querySelector('#pointsTable tbody');
const historyBody = document.querySelector('#historyTable tbody');

// ─────────────────────── Functions ───────────────────────
function syncPoints() {
  fetch(POINTS_WEB_APP_URL, { method: 'POST', body: JSON.stringify(points), mode: 'no-cors', headers: {'Content-Type':'text/plain'} });
}
function syncLog(entry) {
  fetch(LOG_WEB_APP_URL, { method: 'POST', body: JSON.stringify(entry), mode: 'no-cors', headers: {'Content-Type':'text/plain'} });
}

function populateStudents(){
  studentSelect.innerHTML = '<option value="">Select Student</option>';
  studentNames.forEach((name, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `${i+1}. ${name}`;
    studentSelect.appendChild(opt);
  });
}

function updateItems(){
  const data = typeSelect.value === 'Tanbeeh' ? tanbeehData : tashjeehData;
  itemSelect.innerHTML = '<option value="">Select Reason</option>';
  data.forEach((it, idx) => {
    const o = document.createElement('option');
    o.value = idx;
    o.textContent = `${it.text} (+${it.pts} pts)`;
    itemSelect.appendChild(o);
  });
}

function renderTable(){
  tableBody.innerHTML = '';
  points.forEach((p, i) => {
    const total = p.tashjeeh - p.tanbeeh;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td style="text-align:left;max-width:220px;word-wrap:break-word;">${studentNames[i]}</td><td class="tan">${p.tanbeeh}</td><td class="tash">${p.tashjeeh}</td><td class="${total >= 0 ? 'total-positive' : 'total-negative'}"><strong>${total}</strong></td>`;
    tableBody.appendChild(tr);
  });
}

function renderHistory(){
  historyBody.innerHTML = '';
  if (history.length === 0) {
    historyBody.innerHTML = '<tr><td colspan="六年" style="text-align:center;color:#888;padding:30px;font-size:15px;">No activity recorded yet</td></tr>';
    return;
  }
  history.slice().reverse().forEach(log => {
    const shortName = studentNames[log.studentId].split(' ').slice(0,4).join(' ') + (studentNames[log.studentId].split(' ').length > 4 ? '...' : '');
    const tr = document.createElement('tr');
    tr.className = log.type === 'Tanbeeh' ? 'log-tanbeeh' : 'log-tashjeeh';
    tr.innerHTML = `<td class="timestamp">${log.time}</td><td>${shortName}</td><td><strong>${log.type}</strong></td><td style="max-width:230px;word-wrap:break-word;">${log.reason}</td><td><strong>${log.type === 'Tanbeeh' ? '-' : '+'}${log.points}</strong></td><td class="teacher-name">${log.teacher}</td>`;
    historyBody.appendChild(tr);
  });
}

function showMsg(txt, type = 'success'){
  messageDiv.innerHTML = `<div class="message ${type}">${txt}</div>`;
  setTimeout(() => messageDiv.innerHTML = '', 5000);
}

function addLogEntry(studentId, type, reason, points, teacher) {
  const now = new Date();
  const timeStr = now.toLocaleString('en-GB', {day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit'});
  history.push({ time: timeStr, studentId, type, reason, points, teacher: teacher.trim() || "Unknown" });
  localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
  renderHistory();
}

// ─────────────────────── Main Actions ───────────────────────
addBtn.onclick = () => {
  const studentId = parseInt(studentSelect.value);
  const type = typeSelect.value;
  const itemIdx = parseInt(itemSelect.value);
  const teacher = teacherNameInput.value.trim();

  if (isNaN(studentId)) return showMsg('Please select a student', 'warn');
  if (isNaN(itemIdx)) return showMsg('Please select a reason', 'warn');
  if (!teacher) return showMsg('Please enter your name', 'warn');

  const data = type === 'Tanbeeh' ? tanbeehData : tashjeehData;
  const pts = data[itemIdx].pts;
  const reasonText = data[itemIdx].text;

  if(type === 'Tanbeeh') points[studentId].tanbeeh += pts;
  else points[studentId].tashjeeh += pts;

  localStorage.setItem(STORAGE_KEY, JSON.stringify(points));
  addLogEntry(studentId, type, reasonText, pts, teacher);
  renderTable();
  syncPoints();

  const now = new Date();
  const timeStr = now.toLocaleString('en-GB', {day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit'});
  syncLog({ time: timeStr, studentId, type, reason: reasonText, points: pts, teacher });

  showMsg(`${pts} pts (${type}) added for ${studentNames[studentId].split(' ')[0]} by ${teacher}`);
  teacherNameInput.value = '';
  itemSelect.value = '';
};

resetStudentBtn.onclick = () => {
  if(!confirm('Reset this student points to zero?')) return;
  const idx = parseInt(studentSelect.value);
  if (isNaN(idx)) return showMsg('Select a student first', 'warn');
  points[idx] = {tanbeeh:0, tashjeeh:0};
  localStorage.setItem(STORAGE_KEY, JSON.stringify(points));
  renderTable();
  syncPoints();
  showMsg(`${studentNames[idx]} points reset`, 'warn');
};

clearHistoryBtn.onclick = () => {
  if (history.length === 0) return showMsg('Log is already empty', 'warn');
  if (confirm('Delete ALL activity log permanently?')) {
    history = [];
    localStorage.removeItem(HISTORY_KEY);
    renderHistory();
    showMsg('Activity log cleared', 'warn');
  }
};

typeSelect.onchange = updateItems;
showParentBtn.onclick = () => window.open("https://docs.google.com/spreadsheets/d/1Bi82dYxv_e7Jkkay-ymk9DucBcqbx7VU8KcSORwtXls/pubhtml", '_blank');
showLogBtn.onclick    = () => window.open("https://docs.google.com/spreadsheets/d/1cfl6o6jXN32pQie_8X4ihB72PFfk9DaNknq1UQUVcD0/pubhtml", '_blank');

// ─────────────────────── Init ───────────────────────
populateStudents();
updateItems();
renderTable();
renderHistory();
syncPoints();
</script>
</body>
</html>
